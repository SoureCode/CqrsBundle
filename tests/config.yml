soure_code_cqrs:
    event_bus:
        message_bus_id: event.bus
    command_bus:
        message_bus_id: command.bus
    query_bus:
        message_bus_id: query.bus

doctrine:
    dbal:
        override_url: true
        url: '%env(DATABASE_URL)%'
        logging: false
    orm:
        auto_generate_proxy_classes: true
        naming_strategy: 'doctrine.orm.naming_strategy.underscore_number_aware'
        auto_mapping: true
        mappings:
            App:
                is_bundle: false
                type: attribute
                dir: '%kernel.project_dir%/Entity'
                prefix: 'SoureCode\Bundle\Cqrs\Tests\App'
                alias: App

framework:
    validation:
        enabled: true
    messenger:
        default_bus: main.bus
        buses:
            main.bus: ~
            command.bus:
                middleware:
                    - validation
                    - doctrine_transaction
            query.bus:
                middleware:
                    - validation
            event.bus:
                default_middleware: allow_no_handlers
                middleware:
                    - validation

services:
    _defaults:
        autowire: true
        autoconfigure: true

    SoureCode\Bundle\Cqrs\Tests\App\:
        resource: './App/'
        exclude:
            - './App/Entity/'

    command.bus.test:
        public: true
        decorates: command.bus
        class: Symfony\Component\Messenger\TraceableMessageBus
        arguments: ['@.inner']

    event.bus.test:
        public: true
        decorates: event.bus
        class: Symfony\Component\Messenger\TraceableMessageBus
        arguments: [ '@.inner' ]

    query.bus.test:
        public: true
        decorates: query.bus
        class: Symfony\Component\Messenger\TraceableMessageBus
        arguments: [ '@.inner' ]
